# MetForce

METeorological data Acquisition for FORCing Environmental models.

## Introduction

MetForce is a tool for data acquisition and manipulation from different data sources to generate meteorological 
data for environmental models. 
It strongly emphasizes the correct handling of UTC time and expects all input and output in this universal standard.

## Installation

Please follow the instructions provided in the [INSTALLATION.md](INSTALLATION.md) file.

## Data Sources and Configuration

Data generation primarily comes from two sources:

1. **Meteorological weather stations:** Data from local weather stations provide a rich source of detailed and accurate meteorological data.

2. **NASA NLDAS Data:** The North American Land Data Assimilation System (NLDAS) is a collaboration project between NASA and several other organizations to provide high-quality, high-resolution data on various environmental and meteorological variables over North America in GRIB formatted files.

Additionally, MetForce utilizes PVLib, a popular open-source library, to calculate zenith and azimuth data. 

All these data sources and their specifics are controlled using a `.toml` configuration file, which provides great flexibility in defining the data sources for each variable, the priority of the data sources, and other specific settings for each source.

## Features

* **Versatile Data Source Mapping:** MetForce allows each column to be assigned to a different data source (e.g., grib files, met stations, pvlib, derived from another column, or a custom source). This versatility allows you to create rich and comprehensive datasets, which incorporate the best-available data from a variety of sources. 

* **Flexible Interpolation:** Utilizing the power of pandas DataFrames, MetForce lets you apply any pandas-based interpolation on the input data. The default is time interpolation, a form of linear interpolation considering time, but you can use any method that fits your specific needs.

* **Embedded Metadata:** To make the output files more understandable and self-contained, MetForce includes useful metadata in the met files. This metadata includes information on the data sources, the interpolation methods used, and other relevant information about how the data was generated.

## Radiation Estimation

As a rule of thumb, unless Diffuse and Direct Shortwave Radiation are provided, they are calculated as 20% and 80% of the Global Radiation, respectively. These numbers can be changed in the configuration file. 

## Data Columns and Units

Each data column in the dataset is associated with a specific unit. The following table provides a mapping of the columns to their units:

| Column Key (toml) | Column Name (met) | Unit |
|-------------------|-------------------| --- |
| day               | Day               | Julian Day (j) |
| hour              | Hr                | Hour (-) |
| minute            | Min               | Minute (-) |
| pressure          | Press             | Millibar (mbar) |
| temperature       | Temp              | Degrees Celsius (°C) |
| relative_humidity | RH                | Percent (%) |
| wind_speed        | WndSpd            | Meters per Second (m/s) |
| wind_direction    | WndDir            | Degrees (°) |
| visibility        | Vis               | Meters (m) |
| aerosol           | Aer               | Meters (m) |
| cloud_cover_1     | CC1               | No Units (-) |
| cloud_cover_2     | CC2               | No Units (-) |
| cloud_cover_3     | CC3               | No Units (-) |
| cloud_cover_4     | CC4               | No Units (-) |
| cloud_cover_5     | CC5               | No Units (-) |
| cloud_cover_6     | CC6               | No Units (-) |
| cloud_cover_7     | CC7               | No Units (-) |
| precipitation     | Precip            | Millimeters (mm) |
| global_shortwave  | Global            | Watts per Square Meter (W/m²) |
| direct_shortwave  | Direct            | Watts per Square Meter (W/m²) |
| diffuse_shortwave | Diffuse           | Watts per Square Meter (W/m²) |
| downwelling_lwir  | LWdwn             | Watts per Square Meter (W/m²) |
| zenith            | Zenith            | Degrees (°) |
| azimuth           | Azimuth           | Degrees (°) |

## Column Keys

Some column keys in the dataset are derived while others are static (legacy ADH columns). The following table provides 
a mapping of the columns that are being generated by MetForce, and the default column keys that are used when searching 
the met station data (this can be changed in the configuration toml file based on your needs).

| Column Key (toml) | Column Name (met) |
|-------------------|-------------------|
| pressure          | BP_mbar           |
| temperature       | AirT_2M           |
| relative_humidity | RH_2M             |
| wind_speed        | Wind_Spd_2M       |
| wind_direction    | Wind_Dir_2M       |
| precipitation     | Precip_Tot        |
| global_shortwave  | PSP_Total         |
| diffuse_shortwave | Diffuse           |
| direct_shortwave  | Direct            |
| downwelling_lwir  | PIR_Flux          |
| zenith            | ZenDeg            |
| azimuth           | AzDeg             |

## Configuration

For more details on the configuration file, please refer to the [CONFIGURATION.md](CONFIGURATION.md) file.
